<div
  #frameElement
  class="widget-frame"
  [class.edit-mode]="isEditMode"
  [class.minimized]="widget.isMinimized"
  [class.maximized]="widget.isMaximized"
  [style.grid-area]="widget.isMaximized ? '' : gridArea"
>
  <!-- Widget Header -->
  <div class="widget-header" *ngIf="!widget.isMinimized">
    <div class="widget-header-left">
      <span class="material-symbols-outlined widget-icon">{{
        getIconName()
      }}</span>
      <span class="widget-title">{{ widget.title }}</span>
    </div>
    <div class="widget-header-right">
      <!-- Settings button - always visible -->
      <button
        type="button"
        class="widget-action-btn widget-settings-btn"
        (click)="onSettings(); $event.stopPropagation()"
        title="Settings"
      >
        <span class="material-symbols-outlined">settings</span>
      </button>
      <!-- Other action buttons - only in edit mode -->
      <ng-container *ngIf="isEditMode">
        <button
          type="button"
          class="widget-action-btn"
          (click)="onMinimize()"
          [title]="widget.isMinimized ? 'Restore' : 'Minimize'"
        >
          <span class="material-symbols-outlined">{{
            widget.isMinimized ? "expand_more" : "minimize"
          }}</span>
        </button>
        <button
          type="button"
          class="widget-action-btn"
          (click)="onMaximize()"
          [title]="widget.isMaximized ? 'Restore' : 'Maximize'"
        >
          <span class="material-symbols-outlined">{{
            widget.isMaximized ? "fullscreen_exit" : "fullscreen"
          }}</span>
        </button>
        <button
          type="button"
          class="widget-action-btn widget-action-delete"
          (click)="onDelete()"
          title="Delete"
        >
          <span class="material-symbols-outlined">close</span>
        </button>
      </ng-container>
    </div>
  </div>

  <!-- Minimized widget controls - visible when minimized -->
  <div class="widget-header-minimized" *ngIf="widget.isMinimized && isEditMode">
    <div class="widget-header-left">
      <span class="material-symbols-outlined widget-icon">{{
        getIconName()
      }}</span>
      <span class="widget-title">{{ widget.title }}</span>
    </div>
    <div class="widget-header-right">
      <button
        type="button"
        class="widget-action-btn"
        (click)="onMinimize()"
        [title]="widget.isMinimized ? 'Restore' : 'Minimize'"
      >
        <span class="material-symbols-outlined">{{
          widget.isMinimized ? "expand_more" : "minimize"
        }}</span>
      </button>
    </div>
  </div>

  <!-- Widget Body -->
  <div class="widget-body" *ngIf="!widget.isMinimized">
    <ng-content></ng-content>
  </div>

  <!-- Resize Handles (only in edit mode) -->
  <div class="widget-resize-handles" *ngIf="isEditMode && !widget.isMinimized">
    <!-- Corner handles -->
    <div
      class="resize-handle resize-handle-nw"
      (mousedown)="onResizeStart($event, 'nw')"
    ></div>
    <div
      class="resize-handle resize-handle-ne"
      (mousedown)="onResizeStart($event, 'ne')"
    ></div>
    <div
      class="resize-handle resize-handle-sw"
      (mousedown)="onResizeStart($event, 'sw')"
    ></div>
    <div
      class="resize-handle resize-handle-se"
      (mousedown)="onResizeStart($event, 'se')"
    ></div>

    <!-- Edge handles -->
    <div
      class="resize-handle resize-handle-n"
      (mousedown)="onResizeStart($event, 'n')"
    ></div>
    <div
      class="resize-handle resize-handle-s"
      (mousedown)="onResizeStart($event, 's')"
    ></div>
    <div
      class="resize-handle resize-handle-w"
      (mousedown)="onResizeStart($event, 'w')"
    ></div>
    <div
      class="resize-handle resize-handle-e"
      (mousedown)="onResizeStart($event, 'e')"
    ></div>
  </div>

  <!-- Drag Handle (only in edit mode) -->
  <div class="widget-drag-handle" *ngIf="isEditMode && !widget.isMinimized">
    <span class="material-symbols-outlined">drag_indicator</span>
  </div>

  <!-- Settings Popup -->
  <app-widget-settings-popup
    [widget]="widget"
    [isOpen]="isSettingsPopupOpen && isEditMode"
    (sizeChange)="onSettingsSizeChange($event)"
    (delete)="onSettingsDelete()"
    (close)="onSettingsClose()"
  ></app-widget-settings-popup>
</div>
