<div class="war-room-container">
  <!-- Main Content -->
  <main class="war-room-main">
    <!-- Map Area -->
    <div class="war-room-map-area">
      <app-war-room-map [nodes]="nodes()" [selectedCompany]="selectedCompany()"
        (nodeSelected)="onNodeSelected($event)"></app-war-room-map>
      @if (addCompanyModalVisible()) {
      <app-add-company-modal #addCompanyModalRef [isVisible]="true" [useMapPositioning]="true"
        (companyAdded)="onCompanyAdded($event)" (close)="onAddCompanyModalClose()" />
      }
    </div>

    <!-- Sidebar -->
    <aside class="war-room-sidebar" [class.expanded]="activityLogVisible() || hubStatusVisible()">
      <!-- Activity Log Toggle Button -->
      <button class="sidebar-toggle-btn activity-log-toggle bio-cell-toggle" [class.active]="activityLogVisible()"
        (click)="toggleActivityLog()"
        [attr.aria-label]="activityLogVisible() ? 'Hide activity log' : 'Show activity log'"
        [attr.aria-expanded]="activityLogVisible()">
        <span class="tactical-edge"></span>
        <span class="toggle-icon" [class.expanded]="activityLogVisible()">▶</span>
        <span class="toggle-text">{{ activityLogVisible() ? 'HIDE LOG' : 'SHOW LOG' }}</span>
      </button>

      <!-- Activity Log Section -->
      <div class="sidebar-section" [class.hidden]="!activityLogVisible()">
        <app-war-room-activity-log [activityLogs]="activityLogs()" [selectedCompanyId]="selectedCompany()?.id || null"
          (companySelected)="onCompanySelected($event)"></app-war-room-activity-log>
      </div>

      <!-- Hub Status Toggle Button -->
      <button class="sidebar-toggle-btn hub-status-toggle bio-cell-toggle" [class.active]="hubStatusVisible()"
        (click)="toggleHubStatus()" [attr.aria-label]="hubStatusVisible() ? 'Hide hub status' : 'Show hub status'"
        [attr.aria-expanded]="hubStatusVisible()">
        <span class="tactical-edge"></span>
        <span class="toggle-icon" [class.expanded]="hubStatusVisible()">▶</span>
        <span class="toggle-text">{{ hubStatusVisible() ? 'HIDE HUB' : 'SHOW HUB' }}</span>
      </button>

      <!-- Hub Status Section -->
      <div class="sidebar-section" [class.hidden]="!hubStatusVisible()">
        <app-war-room-hub-status [selectedCompany]="selectedCompany()"
          (addCompanyRequested)="onAddCompanyRequested()"></app-war-room-hub-status>
      </div>
    </aside>
  </main>
</div>